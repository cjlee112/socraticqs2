<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Socraticqs2 as LTI provider &mdash; Socraticqs2 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Socraticqs2 0.1 documentation" href="index.html" />
    <link rel="next" title="Socraticqs2 Social Auth registration" href="psa.html" />
    <link rel="prev" title="Writing Guided Activities (Finite State Machines)" href="fsm.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="psa.html" title="Socraticqs2 Social Auth registration"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="fsm.html" title="Writing Guided Activities (Finite State Machines)"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Socraticqs2 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="socraticqs2-as-lti-provider">
<h1>Socraticqs2 as LTI provider<a class="headerlink" href="#socraticqs2-as-lti-provider" title="Permalink to this headline">¶</a></h1>
<div class="section" id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h2>
<p><strong>Tool Provider</strong></p>
<p>A Tool Provider exposes interfaces to one or more tools. It is useful to think of the Tool Provider as a wrapper around
a tool. In this sense, the Tool Provider represents the entire system of Tool plus its interfaces.</p>
<p><strong>Tool Consumer</strong></p>
<p>Instructors and students typically access Tools by activating links from within an LMS. But the LTI standard supports
other scenarios, too. For example, you might want to launch a learning tool from Facebook, or your Google home page.
Any system that offers access to a Tool is called a Tool Consumer.</p>
<p><strong>Context</strong></p>
<p>Links for Tools typically appear in the context of some course. But they may appear within other types of groups.
For example, links might appear within the context of a student organization, club, study group, etc.
Since Tools may be launched from many different types of contexts, the LTI Specification rarely uses the term “course”
and instead uses the more general term “context.”</p>
<p><strong>Resource Link</strong></p>
<p>The Tool Consumer uses Resource Link entities to generate clickable links within its user interface.
Each Resource Link has a title which defines the text that should appear in the clickable link plus an
optional description which should appear alongside the link.
Having introduced the key concepts featured in the LTI standard, let&#8217;s look at some of these ideas in more detail.</p>
<p><strong>Consumer key</strong></p>
<p>This string value is generated by the tool provider to allow them to uniquely
identify the source of requests being received.</p>
<p><strong>LTI secret</strong></p>
<p>The communications between the tool provider and the tool consumer are
secured using a signature generated using the OAuth 1.0 protocol [OAuth-A] with the shared
secret (which should be known only to the tool provider and the tool consumer).</p>
</div>
<div class="section" id="settings-for-socraticqs2-lti-provider">
<h2>Settings for Socraticqs2 LTI provider<a class="headerlink" href="#settings-for-socraticqs2-lti-provider" title="Permalink to this headline">¶</a></h2>
<p>Allow debug information about LTI request</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LTI_DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>Allow to uniquely identify Tool Consumer</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CONSUMER_KEY</span> <span class="o">=</span> <span class="s">&quot;__consumer_key__&quot;</span>
</pre></div>
</div>
<p>To secure communications between the Tool Provider and Tool Consumer using OAuth</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">LTI_SECRET</span> <span class="o">=</span> <span class="s">&quot;__lti_secret__&quot;</span>
</pre></div>
</div>
<p>To permit cross-origin framing</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">X_FRAME_OPTIONS</span> <span class="o">=</span> <span class="s">&quot;GOFORIT&quot;</span>
</pre></div>
</div>
<p>Heroku SSL proxy fix</p>
<div class="highlight-python"><div class="highlight"><pre>SECURE_PROXY_SSL_HEADER = (&#39;HTTP_X_FORWARDED_PROTO&#39;, &#39;https&#39;))
</pre></div>
</div>
</div>
<div class="section" id="adding-new-external-tool-on-moodle-lti-consumer">
<h2>Adding new External tool on Moodle LTI consumer<a class="headerlink" href="#adding-new-external-tool-on-moodle-lti-consumer" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Go to Control Panel of your course</li>
<li>Click on <code class="docutils literal"><span class="pre">Add</span> <span class="pre">an</span> <span class="pre">activity</span> <span class="pre">or</span> <span class="pre">resource</span></code> button</li>
<li>Select <code class="docutils literal"><span class="pre">External</span> <span class="pre">tool</span></code> Activity</li>
<li>Click Add</li>
<li>Click <code class="docutils literal"><span class="pre">Show</span> <span class="pre">more</span></code> on Adding a new External tool page</li>
<li>Type Activity name</li>
<li>Go to Socraticqs2 site</li>
<li>Login as Instructor</li>
<li>Go to course edit page or unit edit page</li>
<li>Copy course or unit URL from <code class="docutils literal"><span class="pre">Copy</span> <span class="pre">course</span> <span class="pre">URL</span></code> input field</li>
<li>Paste this URL into <code class="docutils literal"><span class="pre">Launch</span> <span class="pre">URL</span></code> input field on External tool page</li>
<li>Alternatively Instructor can create a new empty Course by adding <code class="docutils literal"><span class="pre">/lti/</span></code> at the end of Socraticqs2 site URL and specify the resulting URL in form of <code class="docutils literal"><span class="pre">https://socraticqs2_domain_name.org/lti/</span></code> into <code class="docutils literal"><span class="pre">Launch</span> <span class="pre">URL</span></code> input field on External tool page</li>
<li>Type <code class="docutils literal"><span class="pre">Consumer</span> <span class="pre">key</span></code> and <code class="docutils literal"><span class="pre">Shared</span> <span class="pre">secret</span></code> on External tool page given from our settings_local.py</li>
<li>Click <code class="docutils literal"><span class="pre">Save</span> <span class="pre">and</span> <span class="pre">display</span></code> or <code class="docutils literal"><span class="pre">Save</span> <span class="pre">and</span> <span class="pre">return</span> <span class="pre">to</span> <span class="pre">course</span></code></li>
</ol>
</div>
<div class="section" id="lti-user-access-flow">
<h2>LTI user access flow<a class="headerlink" href="#lti-user-access-flow" title="Permalink to this headline">¶</a></h2>
<p>When LTI user is accessed External Tool we handle LTI request to get all user information from LTI Consumer.</p>
<p>First of all we are verifying LTI request using python port of the useful ims-lti Ruby library.</p>
<p>It can be reviewed there <a class="reference external" href="https://github.com/mitodl/ims_lti_py">https://github.com/mitodl/ims_lti_py</a></p>
<p>Next we store LTIUser entry with appropriate LTI params.</p>
<p>Launch LTI request is handled by followed views:</p>
<blockquote>
<div><span class="target" id="module-lti.views"></span><dl class="function">
<dt id="lti.views.create_courseref">
<code class="descclassname">lti.views.</code><code class="descname">create_courseref</code><span class="sig-paren">(</span><em>request</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#lti.views.create_courseref" title="Permalink to this definition">¶</a></dt>
<dd><p>Create CourseRef and Course entry based on context_title.</p>
</dd></dl>

<dl class="function">
<dt id="lti.views.lti_init">
<code class="descclassname">lti.views.</code><code class="descname">lti_init</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#lti.views.lti_init" title="Permalink to this definition">¶</a></dt>
<dd><p>LTI init view</p>
<p>Analyze LTI POST request to start LTI session.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>course_id</strong> &#8211; course id from launch url</li>
<li><strong>unit_id</strong> &#8211; unit id from lunch url</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="lti.views.lti_redirect">
<code class="descclassname">lti.views.</code><code class="descname">lti_redirect</code><span class="sig-paren">(</span><em>request</em>, <em>course_id=None</em>, <em>unit_id=None</em><span class="sig-paren">)</span><a class="headerlink" href="#lti.views.lti_redirect" title="Permalink to this definition">¶</a></dt>
<dd><p>Create user and redirect to Course</p>
<div class="line-block">
<div class="line">Create LTIUser with all needed link to Django user</div>
<div class="line">and/or UserSocialAuth.</div>
<div class="line">Finally login Django user and redirect to Course</div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>unit_id</strong> &#8211; unit id from lunch url</td>
</tr>
</tbody>
</table>
</dd></dl>

</div></blockquote>
<p>To work with Socraticqs2 courses we need to create/get django user to authorize him and need to have Role objects to have access to courses.</p>
<p>For this requirements we have <code class="docutils literal"><span class="pre">create_links</span></code> and <code class="docutils literal"><span class="pre">enroll</span></code> methods in LTIUser class.</p>
<blockquote>
<div><dl class="class">
<dt id="lti.models.LTIUser">
<em class="property">class </em><code class="descclassname">lti.models.</code><code class="descname">LTIUser</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#lti.models.LTIUser" title="Permalink to this definition">¶</a></dt>
<dd><p>Model for LTI user</p>
<p><strong>Fields:</strong></p>
<blockquote>
<div><dl class="attribute">
<dt id="lti.views.LTIUser.user_id">
<code class="descname">user_id</code><a class="headerlink" href="#lti.views.LTIUser.user_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>uniquely identifies the user within LTI Consumer</p>
<dl class="attribute">
<dt id="lti.views.LTIUser.consumer">
<code class="descname">consumer</code><a class="headerlink" href="#lti.views.LTIUser.consumer" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>uniquely  identifies the Tool Consumer</p>
<dl class="attribute">
<dt id="lti.views.LTIUser.extra_data">
<code class="descname">extra_data</code><a class="headerlink" href="#lti.views.LTIUser.extra_data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>user params received from LTI Consumer</p>
<dl class="attribute">
<dt id="lti.views.LTIUser.django_user">
<code class="descname">django_user</code><a class="headerlink" href="#lti.views.LTIUser.django_user" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Django user to store study progress</p>
<dl class="attribute">
<dt id="lti.views.LTIUser.context_id">
<code class="descname">context_id</code><a class="headerlink" href="#lti.views.LTIUser.context_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Context id given from LTI params</p>
</div></blockquote>
<p>LTI user params saved to extra_data field:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;user_id&#39;</span>
<span class="s">&#39;context_id&#39;</span>
<span class="s">&#39;lis_person_name_full&#39;</span>
<span class="s">&#39;lis_person_name_given&#39;</span>
<span class="s">&#39;lis_person_name_family&#39;</span>
<span class="s">&#39;lis_person_sourcedid&#39;</span>
<span class="s">&#39;tool_consumer_instance_guid&#39;</span>
<span class="s">&#39;lis_person_contact_email_primary&#39;</span>
<span class="s">&#39;tool_consumer_info_product_family_code&#39;</span>
</pre></div>
</div>
<dl class="method">
<dt id="lti.models.LTIUser.create_links">
<code class="descname">create_links</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lti.models.LTIUser.create_links" title="Permalink to this definition">¶</a></dt>
<dd><p>Create all needed links to Django and/or UserSocialAuth.</p>
</dd></dl>

<dl class="method">
<dt id="lti.models.LTIUser.enroll">
<code class="descname">enroll</code><span class="sig-paren">(</span><em>roles</em>, <em>course_id</em><span class="sig-paren">)</span><a class="headerlink" href="#lti.models.LTIUser.enroll" title="Permalink to this definition">¶</a></dt>
<dd><p>Create Role according to user roles from LTI POST</p>
<p>roles -&gt; roles of LTI user given from LTI Consumer
course_id -&gt; Course entry id given from Launch URL</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>roles</strong> &#8211; (str|list)</li>
<li><strong>course_id</strong> &#8211; int</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lti.models.LTIUser.is_enrolled">
<code class="descname">is_enrolled</code><span class="sig-paren">(</span><em>roles</em>, <em>course_id</em><span class="sig-paren">)</span><a class="headerlink" href="#lti.models.LTIUser.is_enrolled" title="Permalink to this definition">¶</a></dt>
<dd><p>Check enroll status</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>roles</strong> &#8211; (str|list)</li>
<li><strong>course_id</strong> &#8211; int</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">bool</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="lti.models.LTIUser.is_linked">
<code class="descname">is_linked</code><a class="headerlink" href="#lti.models.LTIUser.is_linked" title="Permalink to this definition">¶</a></dt>
<dd><p>Check link to some Django user</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lti.models.LTIUser.login">
<code class="descname">login</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="headerlink" href="#lti.models.LTIUser.login" title="Permalink to this definition">¶</a></dt>
<dd><p>Login linked Django user.</p>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
<div class="section" id="course-creation-process">
<h2>Course creation process<a class="headerlink" href="#course-creation-process" title="Permalink to this headline">¶</a></h2>
<p>When Instructor set <code class="docutils literal"><span class="pre">/lti/</span></code> as the LaunchURL for External Tool he can create a blank Course on Socraticqs2 Tool Provider.</p>
<p><strong>To implement this we follow the next logic:</strong></p>
<ul>
<li><p class="first">First of all, we look at the <code class="docutils literal"><span class="pre">roles</span></code> LTI param to decide whether the user can create courses or not.</p>
</li>
<li><p class="first">Next we look for <code class="docutils literal"><span class="pre">context_id</span></code> LTI param to search our <code class="docutils literal"><span class="pre">CourseRef</span></code> models.</p>
</li>
<li><p class="first">That models is a link between Course and particular University identified by <code class="docutils literal"><span class="pre">context_id</span></code>.</p>
<dl class="class">
<dt id="lti.models.CourseRef">
<em class="property">class </em><code class="descclassname">lti.models.</code><code class="descname">CourseRef</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#lti.models.CourseRef" title="Permalink to this definition">¶</a></dt>
<dd><p>Course reference</p>
<p>Represent Course reference with meta information
such as:</p>
<div class="highlight-python"><div class="highlight"><pre>course -&gt; Courslet Course entry
instructors -&gt; list of User entry
date - &gt; creation date
context_id -&gt; LTI context_id
tc_guid - &gt; LTI tool_consumer_instance_guid
</pre></div>
</div>
</dd></dl>

</li>
<li><p class="first">If we find a <code class="docutils literal"><span class="pre">CourseRef</span></code> entry we just redirect user to a Course.</p>
</li>
<li><p class="first">If there is no <code class="docutils literal"><span class="pre">CourseRef</span></code> and user has role <code class="docutils literal"><span class="pre">Instructor</span></code> in <code class="docutils literal"><span class="pre">roles</span></code> LTI param we direct the user to the <code class="docutils literal"><span class="pre">create_courseref</span></code> view:</p>
<dl class="function">
<dt>
<code class="descclassname">lti.views.</code><code class="descname">create_courseref</code><span class="sig-paren">(</span><em>request</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span></dt>
<dd><p>Create CourseRef and Course entry based on context_title.</p>
</dd></dl>

<p><strong>That view do the following:</strong></p>
<blockquote>
<div><ul class="simple">
<li>creates a new Course with <code class="docutils literal"><span class="pre">context_title</span></code> title</li>
<li>creates Instructor <code class="docutils literal"><span class="pre">Role</span></code> for a django user with which the LTI user is associated</li>
<li>creates <code class="docutils literal"><span class="pre">CourseRef</span></code> entry to link Tool Consumer with this Course</li>
<li>adds LTI user to Instructor&#8217;s set of that Course</li>
<li>redirects user to Course edit page</li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Also we ensure that user is requests for Course creation only from LTI session using <code class="docutils literal"><span class="pre">only_lti</span></code> decorator:</p>
<blockquote>
<div><dl class="function">
<dt id="lti.utils.only_lti">
<code class="descclassname">lti.utils.</code><code class="descname">only_lti</code><span class="sig-paren">(</span><em>fn</em><span class="sig-paren">)</span><a class="headerlink" href="#lti.utils.only_lti" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator ensures that user comes from LTI session.</p>
</dd></dl>

</div></blockquote>
<p>Finally Instructor can change LaunchURL to a <code class="docutils literal"><span class="pre">/lti/unit/{unit_id}/</span></code> pattern to point directly to a particular unit of the Course if he has created one previously.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Socraticqs2 as LTI provider</a><ul>
<li><a class="reference internal" href="#terminology">Terminology</a></li>
<li><a class="reference internal" href="#settings-for-socraticqs2-lti-provider">Settings for Socraticqs2 LTI provider</a></li>
<li><a class="reference internal" href="#adding-new-external-tool-on-moodle-lti-consumer">Adding new External tool on Moodle LTI consumer</a></li>
<li><a class="reference internal" href="#lti-user-access-flow">LTI user access flow</a></li>
<li><a class="reference internal" href="#course-creation-process">Course creation process</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="fsm.html"
                        title="previous chapter">Writing Guided Activities (Finite State Machines)</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="psa.html"
                        title="next chapter">Socraticqs2 Social Auth registration</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/lti.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="psa.html" title="Socraticqs2 Social Auth registration"
             >next</a> |</li>
        <li class="right" >
          <a href="fsm.html" title="Writing Guided Activities (Finite State Machines)"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Socraticqs2 0.1 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Christopher Lee.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>