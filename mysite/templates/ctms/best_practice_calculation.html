{% extends "ctms_base.html" %}
{% load staticfiles %}

{% block title %}
    Get Started
{% endblock %}

{% block content %}
<div class="card mod">
    <div class="card__header">
      <h1>{{ object }}</h1>
    </div>
    <main class="card__content">
      <h2 class="card__content__title">
        Enter your values here
      </h2>
      <form method="post" id="bp-analysis">{% csrf_token %}
        <div class="input__row">
          <div class="input__row__item">
            <label for="row-input-number">How many students do you have in your class?</label>
            <input id="row-input-number" type="number" name="row-input-number">
          </div>
          <div class="input__row__item percent">
            <label for="row-input-number">What is the mean percent score on a typical exam?</label>
            <input id="row-input-percent" type="number" name="row-input-number">
          </div>
        </div>
        <div class="input__row">
          <div class="input__row__item">
            <label for="row-input-number-2">How many question-parts do you have in a typical exam?
              <span>(e.g. 8 questions with 3 parts each = 24)</span>
            </label>
            <input id="row-input-number-2" type="number" name="row-input-number-2">
          </div>
          <div class="input__row__item">
            <label for="row-input-number-3">How many individual student misconceptions do you fix in a typical exam?</label>
            <input id="row-input-number-3" type="number" name="row-input-number-3">
          </div>
        </div>
        <p>
          {% for key, value in input_data.items %}
          <label for="{{ key }}">{{ value.label }}</label>
          <input type="{{ value.type }}" name="{{ key }}">
          {% endfor %}
        </p>
        <input type="submit" class="btn-mod" value="Calculate">
      </form>
      <div id='result' hidden>
        <h2>Impact Analysis</h2><br>
        <ul>
          <div id='estimated_blindspots'></div>
        </ul>
        <form action="" id="fake-form" method="POST">
          {% csrf_token %}
          <input type="submit" class="btn" value="Next">
        </form>
      </div>
    </main>
</div>

<div class="card-mod">
  <main class="card__content">
    <h2 class="card__content__title">
      Calculated impact for your class
    </h2>
    <h3>
      Student blindspots resolved by your practice exam
    </h3>
    <ul class="blindspots">
      <li class="blindspots__item">
          <span class="blindspots__number">
            35
          </span>
        Without Courselets
      </li>
      <li class="blindspots__item">
          <span class="blindspots__number">
            1344
          </span>
        With Courselets
      </li>
      <li class="blindspots__item">
        <a href="/">
          Recalculate
        </a>
      </li>
    </ul>
    <div class="text-block">
      <h3>
        How we calculated impact
      </h3>
      <p>
        1 student blindspot = 1 student response (to a question-part) that exposes a misconception. Your practice exam is projected to expose 6.72 blindspots on average for each student. Resolving all these for 200 students individually is inefficient compared with using Courselets
      </p>
    </div>
    <div class="text-block">
      <h3>
        Recommendations
      </h3>
      <p>
        Your exam data indicate that there are far too many total student blindspots on this upcoming exam, for you to resolve them all in office hours or discussion forums.  To genuinely fix this number of student blindspots, you need an online platform that's actually designed to identify and resolve student blindspots with the least instructor effort possible.  Specifically, because identifying a blindspot for one student on Courselets will automatically help all students with that blindspot, you can focus your efforts on exactly what will help the most students, gaining a massive multiplier in student learning at no increase in effort.
      </p>
    </div>
    <div class="text-right">
      <input type="submit" class="btn-mod" value="Create a Courselet">
    </div>
  </main>
</div>

{% endblock %}

{% block js %}
  <script>
      $(document).ready(function(){
        $form = $('#bp-analysis');
        $form.on('submit', function(e){
          e.preventDefault();
          var formData = $form.serializeArray();
          formData.push(
            {name: "best_practice_template_id", value: '{{ best_practice_template_id }}'},
          );
          console.log(formData);
          $.ajax({
            headers: {
              "X-CSRFToken": '{{ csrf_token }}'
            },
            data: formData,
            method: 'POST',
            url: '/api/v0/bp-analysis/'
          })
          .done( function(response) {
            console.log(response.result_data);
            $form.hide()
            $("#result").removeAttr('hidden');
            $.each( response.result_data, function( index, value ){
              $("#estimated_blindspots").append( "<li>" + String(value)+ "</li>")
            });
          })
          .fail( function(error) {
            alert('Something went wrong. Please refresh the page and try again.');
          })
        });
        $fake_form = $('#fake-form');
        $fake_form.on('submit', function(e){
          e.preventDefault();
          $form.unbind()
          $form.submit()
        });
      });
  </script>
{% endblock %}
