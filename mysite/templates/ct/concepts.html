{% extends "ct/portal.html" %}
{% load crispy_forms_tags %}
{% comment %}
  View or edit a course
{% endcomment %}

{% block title %}
  Courselets.org Concepts
{% endblock %}

{% block content %}
{{ msg }}

{% if conceptLinks.data %}
<h2>{{ conceptLinks.title }}</h2>
<table class="table table-striped">
<thead><tr>
{% for h in conceptLinks.headers %}
  <th>{{ h }}</th>
{% endfor %}
</tr></thead>
<tbody>
{% for cl,clform in conceptLinks.data %}
  <tr>
    <td>
    <form action="{{ actionTarget }}" method="post"
          style=" display:inline!important;">
    {% csrf_token %}
    {{ clform.relationship }}
    <input type="hidden" name="clID" value="{{ cl.id }}" />
    <input type="submit" value="Update" />
    </form>
    </td>
    <td><a href="{{ actionTarget }}{{ cl.pk }}/">
        {{ cl.concept.title }}</a></td>
  </tr>
{% endfor %}
</tbody>
</table>
{% endif %}

{% if toTable.data %}
<h2>{{ toTable.title }}</h2>
<table class="table table-striped">
<thead><tr>
{% for h in toTable.headers %}
  <th>{{ h }}</th>
{% endfor %}
</tr></thead>
<tbody>
{% for cg,cgform in toTable.data %}
  <tr>
    <td>
    <form action="{{ actionTarget }}" method="post"
          style=" display:inline!important;">
    {% csrf_token %}
    {{ cgform.relationship }}
    <input type="hidden" name="cgID" value="{{ cg.id }}" />
    <input type="submit" value="Update" title="click to update the relationship" />
    </form>
    <form action="{{ actionTarget }}" method="post"
          style=" display:inline!important;">
    {% csrf_token %}
    <input type="hidden" name="task" value="reverse" />
    <input type="hidden" name="cgID" value="{{ cg.id }}" />
    <input type="submit" value="Reverse" title="click to reverse the relationship between these concepts" />
    </form>
    </td>
    <td><a href="{{ actionTarget }}{{ cg.pk }}/">
        {{ cg.toConcept.title }}</a></td>
  </tr>
{% endfor %}
</tbody>
</table>
{% endif %}

{% if fromTable.data %}
<h2>{{ fromTable.title }}</h2>
<table class="table table-striped">
<thead><tr>
{% for h in fromTable.headers %}
  <th>{{ h }}</th>
{% endfor %}
</tr></thead>
<tbody>
{% for cg,cgform in fromTable.data %}
  <tr>
    <td><a href="{{ actionTarget }}{{ cg.pk }}/">
        {{ cg.fromConcept.title }}</a></td>
    <td>
    <form action="{{ actionTarget }}" method="post"
          style=" display:inline!important;">
    {% csrf_token %}
    {{ cgform.relationship }}
    <input type="hidden" name="cgID" value="{{ cg.id }}" />
    <input type="submit" value="Update" title="click to update the relationship" />
    </form>
    <form action="{{ actionTarget }}" method="post"
          style=" display:inline!important;">
    {% csrf_token %}
    <input type="hidden" name="task" value="reverse" />
    <input type="hidden" name="cgID" value="{{ cg.id }}" />
    <input type="submit" value="Reverse" title="click to reverse the relationship between these concepts" />
    </form>
    </td>
  </tr>
{% endfor %}
</tbody>
</table>
{% endif %}

<form action="{{ actionTarget }}" method="get">
{{ searchForm }}
<input type="submit" value="Search" />
</form>

{% if cset or wset %}
<h2>Search Results</h2>
{% endif %}

{% if cset %}
<h3>Concepts linked to other Courselets.org Questions</h3>
If one of these matches the concept your question mainly aims to test,
please click <b>Link question to this concept</b>.
<ul>
{% for c in cset %}
  <li><a href="{% url 'ct:concept' c.id %}">{{ c.title }}</a>
  <form action="{{ actionTarget }}" method="post"
   style=" display:inline!important;">
  {% csrf_token %}
  <input type="hidden" name="conceptID" value="{{ c.id }}" />
  <input type="submit" value="Link question to this concept" />
  </form>
  : {{ c.description }}
  </li>
{% endfor %}
</ul>
{% endif %}

{% if wset %}

<h3>Concepts found in Wikipedia</h3>
If one of these matches the concept your question mainly aims to test,
and does <b>not</b> match any concept already added to Courselets.org
(above),
please click <b>Link question to this concept</b>.
To see details from Wikipedia about each concept, just click its title.
<ul>
{% for title, sourceID, sourceURL in wset %}
  <li><a href="{{ sourceURL }}">{{ title }}</a>:
  <form action="{{ actionTarget }}" method="post"
   style=" display:inline!important;">
  {% csrf_token %}
  <input type="hidden" name="wikipediaID" value="{{ sourceID }}" />
  <input type="submit" value="Link question to this concept" />
  </form>
  </li>
{% endfor %}
</ul>

{% if conceptForm %}
<h3>Write a New Concept</h3>
If none of the above matches your intended concept, you can add it
directly by giving a short title and description, then click <b>Add</b>.

<div class="container-fluid">
{% crispy conceptForm %}
</div>

{% endif %}
{% endif %}

{% endblock %}
